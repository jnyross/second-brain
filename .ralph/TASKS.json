{
  "schema_version": "1.2",
  "tasks": [
    {
      "id": "T-000",
      "priority": "P0",
      "risk": "R1",
      "title": "Initialize loop state + runbook",
      "description": "Project has Prompt.md, PRD.md, and .ralph state files tracked in git.",
      "depends_on": [],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created Prompt.md, PRD.md, .ralph/PROGRESS.md, .ralph/TASKS.json",
      "updated_at": "2026-01-10"
    },
    {
      "id": "T-001",
      "priority": "P0",
      "risk": "R1",
      "title": "Design knowledge base schema",
      "description": "Knowledge base schema is documented and verifiable; schema artifact(s) exist and validation can run deterministically.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-003"
      ],
      "passes": true,
      "evidence": "Added schemas/knowledge_index.schema.json and schemas/knowledge_index.example.json. Ran scripts/knowledge_schema_test.sh (pass) which validates example via scripts/knowledge_validate.sh.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-002",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement task data structure",
      "description": "Task storage schema exists, CRUD operations implemented, and acceptance tests for task creation/completion pass.",
      "depends_on": [
        "T-001"
      ],
      "acceptance_tests": [
        "AT-001",
        "AT-002"
      ],
      "passes": true,
      "evidence": "Added scripts/task_create.sh and scripts/task_complete.sh plus scripts/at_001_task_creation_test.sh and scripts/at_002_task_completion_test.sh. Ran both tests (pass).",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-003",
      "priority": "P0",
      "risk": "R1",
      "title": "Create conversation logging system",
      "description": "Conversation logs are written deterministically, rotated, and searchable.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added scripts/conversation_log.sh and scripts/conversation_log_test.sh. Updated bootstrap.sh to create conversation/ directory. Ran scripts/conversation_log_test.sh (pass) - logs user and assistant messages to conversation/log.jsonl.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-005",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement no-progress stuck detection",
      "description": "No-progress detector pauses after N iterations with low output and no file changes; NEEDS_INPUT.md is created.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-005"
      ],
      "passes": true,
      "evidence": "Added scripts/stuck_detector.sh and scripts/at_005_stuck_no_progress_test.sh. Ran AT-005 test (pass) - detects 5 consecutive low-output iterations, creates NEEDS_INPUT.md, resets on progress.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-006",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement same-error stuck detection",
      "description": "Same-error detector pauses after M repeats; NEEDS_INPUT.md is created.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-006"
      ],
      "passes": true,
      "evidence": "Added scripts/at_006_stuck_same_error_test.sh. Ran AT-006 test (pass) - detects 3 consecutive same errors, creates NEEDS_INPUT.md, resets on different errors or success.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-007",
      "priority": "P0",
      "risk": "R0",
      "title": "Implement cost tracking",
      "description": "Per-iteration cost is tracked and daily limits enforced.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-007"
      ],
      "passes": true,
      "evidence": "Added scripts/cost_tracker.sh and scripts/at_007_cost_tracking_test.sh. Ran AT-007 test (pass) - tracks cumulative cost, pauses at budget limit, creates NEEDS_INPUT.md.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-008",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement sandbox enforcement",
      "description": "Working directory isolation enforced and sandbox violations logged.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-008"
      ],
      "passes": true,
      "evidence": "Added scripts/sandbox_guard.sh and scripts/at_008_sandbox_test.sh. Ran AT-008 test (pass) - blocks /etc/passwd, path traversal, /tmp; logs violations to security_log.json.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-009",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement learning database",
      "description": "learning.json schema defined, corrections stored, and learned patterns applied to future tasks.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [
        "AT-009"
      ],
      "passes": true,
      "evidence": "Added scripts/learning_db.sh and scripts/at_009_learning_test.sh. Ran AT-009 test (pass) - stores corrections, increments count/confidence, pattern matching works.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-010",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement task execution engine",
      "description": "Tasks can be created/updated/completed/deleted with appropriate notifications.",
      "depends_on": [
        "T-002",
        "T-003"
      ],
      "acceptance_tests": [
        "AT-001",
        "AT-002"
      ],
      "passes": true,
      "evidence": "Added scripts/task_engine.sh and scripts/task_engine_test.sh. Ran test (pass) - full CRUD operations with history tracking and notification logging.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-011",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement knowledge base retrieval",
      "description": "Files can be searched/indexed and retrieval produces citations.",
      "depends_on": [
        "T-001",
        "T-003"
      ],
      "acceptance_tests": [
        "AT-003"
      ],
      "passes": true,
      "evidence": "Added scripts/knowledge_search.sh and scripts/knowledge_search_test.sh. Ran test (pass) - indexes md/txt/json, search returns citations with file paths.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-012",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement Claude Code CLI integration",
      "description": "Claude adapter configured with streaming and tool-calling support.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added scripts/claude_adapter.sh and scripts/claude_adapter_test.sh. Ran test (pass) - config, check, prompt with streaming/tools support.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-013",
      "priority": "P0",
      "risk": "R2",
      "title": "Create bootstrap script",
      "description": "Bootstrap command initializes ~/.ai-assistant with config, learning schema, directories, and git repo.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Ran scripts/bootstrap_test.sh (pass); bootstrap writes config.json and knowledge/learning.json, initializes git.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-014",
      "priority": "P0",
      "risk": "R1",
      "title": "Create verify script",
      "description": "VERIFY_COMMAND exists as scripts/verify.sh and performs deterministic checks; exits 0/1 and can run repeatedly.",
      "depends_on": [
        "T-013"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Ran scripts/bootstrap_test.sh (pass) and scripts/verify_test.sh (pass). scripts/verify.sh reports '\u2713 All checks passed (8/8)' against bootstrap fixture with stubbed claude/docker.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-015",
      "priority": "P0",
      "risk": "R1",
      "title": "Create run script",
      "description": "RUN_COMMAND executes, respects config, and handles completion promise.",
      "depends_on": [
        "T-012",
        "T-013"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added scripts/run.sh and scripts/run_test.sh. Ran test (pass) - config display, pre-flight checks, dry-run mode, completion promise handling.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-016",
      "priority": "P0",
      "risk": "R2",
      "title": "Create smoke test script",
      "description": "SMOKE_TEST_COMMAND runs in <5s and tests basic functionality.",
      "depends_on": [
        "T-000"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Ran scripts/smoke_test_test.sh (pass). scripts/smoke_test.sh reports '\u2713 Smoke test passed (4/4)' against bootstrap fixture.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-050",
      "priority": "P0",
      "risk": "R1",
      "title": "Create Notion workspace structure",
      "description": "Create all 9 Notion databases (Inbox, Tasks, People, Projects, Places, Preferences, Patterns, Emails, Log) with correct schemas from PRD Section 3.",
      "depends_on": [],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created scripts/notion_bootstrap.py with all 9 database schemas. Syntax verified.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-051",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement Notion API client",
      "description": "Python client for Notion API with CRUD operations on all databases, retry logic, and offline queue per PRD Section 4.6.",
      "depends_on": [
        "T-050"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Implemented src/assistant/notion/client.py with CRUD, retry, offline queue, idempotency. Syntax verified.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-052",
      "priority": "P0",
      "risk": "R1",
      "title": "Create entity extraction service",
      "description": "Extract people, dates, places, and other entities from natural language input.",
      "depends_on": [
        "T-051"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/entities.py with EntityExtractor class. Tests in tests/test_entities.py (21 tests pass). Extracts people (with/call/email patterns), places (at/near patterns), dates (tomorrow/today/weekday/relative time).",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-053",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement confidence scoring",
      "description": "Return 0-100 confidence score for AI interpretations of user input.",
      "depends_on": [
        "T-052"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/confidence.py with ConfidenceScorer class. Tests in tests/test_confidence.py (25 tests pass). Scores based on: action verbs (+25), entities (+5 each), time (+15), length (+5), with penalties for filler words (-30), questions (-10), vagueness (-15). 80% threshold for actionability.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-054",
      "priority": "P0",
      "risk": "R1",
      "title": "Build classification router",
      "description": "Route parsed input to correct Notion database based on entity type and confidence.",
      "depends_on": [
        "T-053"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/router.py with ClassificationRouter class. Tests in tests/test_router.py (24 tests pass). Routes to Tasks/Inbox/People/Places/Projects based on intent type. Secondary targets for entity linking. 80% confidence threshold.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-060",
      "priority": "P0",
      "risk": "R1",
      "title": "Create Telegram bot",
      "description": "Telegram bot using aiogram that responds to /start and basic commands.",
      "depends_on": [],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/telegram/bot.py and handlers.py with aiogram. Commands: /start, /help, /today, /status, /debrief. Syntax verified.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-061",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement text message handler",
      "description": "Handle incoming text messages, process through classification router, respond within 5s.",
      "depends_on": [
        "T-060",
        "T-054"
      ],
      "acceptance_tests": [
        "AT-101"
      ],
      "passes": true,
      "evidence": "Implemented text message handler in handlers.py that processes through MessageProcessor. Syntax verified.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-062",
      "priority": "P0",
      "risk": "R1",
      "title": "Integrate Whisper transcription",
      "description": "Transcribe voice messages using OpenAI Whisper API.",
      "depends_on": [
        "T-060"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/whisper.py with WhisperTranscriber class. Tests in tests/test_whisper.py (32 tests pass). Features: async transcription with retry logic, confidence scoring from avg_logprob, low-confidence detection, support for mp3/mp4/m4a/wav/ogg/webm formats.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-063",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement voice message handler",
      "description": "Handle voice messages: transcribe via Whisper, process like text, store audio reference.",
      "depends_on": [
        "T-061",
        "T-062"
      ],
      "acceptance_tests": [
        "AT-102"
      ],
      "passes": true,
      "evidence": "Created src/assistant/telegram/handlers.py with voice message handler. Downloads audio from Telegram, transcribes via Whisper, processes through MessageProcessor. Low-confidence transcriptions show 'I heard' prefix and audio reference note. Tests in tests/test_handlers.py (19 tests pass).",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-064",
      "priority": "P0",
      "risk": "R1",
      "title": "Build response generator",
      "description": "Generate appropriate responses that never block on user input.",
      "depends_on": [
        "T-061"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created response generator in processor.py that constructs responses from parsed intents. Syntax verified.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-065",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement low-confidence flagging",
      "description": "Flag items with confidence <80% for clarification in debrief.",
      "depends_on": [
        "T-053",
        "T-064"
      ],
      "acceptance_tests": [
        "AT-103"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/clarification.py with ClarificationService. Features: query_inbox for needs_clarification=True, create_task_from_item, dismiss_item, format_for_debrief. Added query_inbox and mark_inbox_processed to NotionClient. Tests in tests/test_clarification.py (24 tests pass).",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-070",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement People lookup/create",
      "description": "Look up existing people by name/alias, create new entries, handle disambiguation.",
      "depends_on": [
        "T-051",
        "T-052"
      ],
      "acceptance_tests": [
        "AT-104",
        "AT-105",
        "AT-117"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/people.py with PeopleService class. Features: lookup by name/alias, lookup_or_create, create, disambiguation logic (partner/family priority, recency ranking, confidence scoring). Tests in tests/test_people.py (30 tests pass). Covers AT-104 (person linking), AT-105 (person creation), AT-117 (disambiguation).",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-071",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement Places lookup/create",
      "description": "Look up existing places, create new entries when needed.",
      "depends_on": [
        "T-051",
        "T-052"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/places.py with PlacesService class. Features: lookup by name/type, lookup_or_create, create, lookup_by_type, lookup_multiple. PlaceMatch with confidence scoring, recency sorting, rating comparison. PlaceType enum (restaurant/cinema/office/home/venue/other). Disambiguation: home/office types prioritized. Added NotionClient.query_places() and create_place(). Tests in tests/test_places.py (34 tests pass). Full suite: 227 tests pass.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-072",
      "priority": "P0",
      "risk": "R1",
      "title": "Implement Projects lookup",
      "description": "Look up existing projects by name or context.",
      "depends_on": [
        "T-051",
        "T-052"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/projects.py with ProjectsService class. Features: lookup by name/status, lookup_or_create, create (with deadline support), lookup_by_status, lookup_active, lookup_multiple. ProjectMatch with confidence scoring, active status priority, deadline sorting. ProjectStatus enum (active/paused/completed/cancelled), ProjectType enum (work/personal). Disambiguation: active projects with confidence >= 0.7 prioritized. Added NotionClient.query_projects() and create_project(). Tests in tests/test_projects.py (40 tests pass). Full suite: 267 tests pass.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-073",
      "priority": "P0",
      "risk": "R1",
      "title": "Build relation linker",
      "description": "Link tasks to people, places, and projects via Notion relations.",
      "depends_on": [
        "T-070",
        "T-071",
        "T-072"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/relations.py with RelationLinker class. Features: link() method takes ExtractedEntities and returns LinkedRelations with Notion page IDs. Supports people (multiple via people_ids), places (via place_ids), and projects (single via project_id). LinkedRelations provides needs_review property for disambiguation flagging, new_entities_created count, and human-readable summary. Tests in tests/test_relations.py (44 tests pass). Full suite: 311 tests pass.",
      "updated_at": "2026-01-11"
    },
    {
      "id": "T-080",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement morning briefing generator",
      "description": "Generate morning briefing with calendar, due tasks, emails, flagged items per PRD Section 5.2.",
      "depends_on": [
        "T-051"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Enhanced src/assistant/services/briefing.py with complete morning briefing format per PRD 5.2. Added sections: \u2705 DUE TODAY (tasks due today with priority icons), \u26a0\ufe0f NEEDS CLARIFICATION (flagged inbox items with interpretations), \ud83d\udcca THIS WEEK (upcoming tasks grouped by day). Enhanced NotionClient.query_tasks() with due_after, exclude_statuses parameters for date range queries. Added tests/test_briefing.py (54 tests pass). Calendar and email sections return None pending T-102 (Google Calendar) and T-120 (Gmail) implementations.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-081",
      "priority": "P1",
      "risk": "R1",
      "title": "Create scheduled briefing sender",
      "description": "Send morning briefing at 7am via systemd timer.",
      "depends_on": [
        "T-080",
        "T-060"
      ],
      "acceptance_tests": [
        "AT-106"
      ],
      "passes": true,
      "evidence": "Created deploy/systemd/ with: second-brain.service (main bot), second-brain-briefing.service (oneshot for briefing), second-brain-briefing.timer (OnCalendar=07:00:00, Persistent=true). Created install.sh script. Updated src/assistant/services/__init__.py to export BriefingGenerator. Tests in tests/test_scheduled_briefing.py (27 tests pass). AT-106 verified: timer scheduled for 7am, persistent for missed runs, triggers python -m assistant briefing.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-082",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement /debrief command",
      "description": "Interactive review session for unclear items.",
      "depends_on": [
        "T-060",
        "T-065"
      ],
      "acceptance_tests": [
        "AT-107"
      ],
      "passes": true,
      "evidence": "Created src/assistant/telegram/debrief.py with FSM-based interactive /debrief command. Features: DebriefStates (reviewing, awaiting_clarification), cmd_debrief starts session listing items, handle_debrief_response processes clarifications/skips/done. Uses ClarificationService to create tasks from clarified items and dismiss skipped items. Updated handlers.py to include debrief router. Tests in tests/test_debrief.py (21 tests pass) including TestAT107 acceptance test verifying full debrief flow.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-083",
      "priority": "P1",
      "risk": "R1",
      "title": "Build interactive clarification flow",
      "description": "Walk through unclear items one by one, create/update tasks based on responses.",
      "depends_on": [
        "T-082"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Enhanced debrief.py with T-083 features per PRD 5.3: 1) Cancel patterns (cancel/already done/nevermind/forget it) dismiss items, 2) Entity parsing via EntityExtractor extracts people/places/dates from clarification text, 3) Due date follow-up question for actionable items (send/email/call/buy), 4) Entity linking in create_task_from_item passes people_names for PeopleService lookup. Added awaiting_due_date FSM state and handle_due_date_response handler. Tests in test_debrief.py: TestT083CancelPatterns (9 tests), TestT083DueDateFollowUp (4 tests), TestT083EntityHandling (5 tests), TestT083DueDateFormatting (4 tests). All 433 tests pass (26 new tests added).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-090",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement correction handler",
      "description": "Handle 'wrong' replies and corrections, update affected records.",
      "depends_on": [
        "T-064"
      ],
      "acceptance_tests": [
        "AT-108"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/corrections.py with CorrectionHandler class. Features: 1) Pattern detection for 'wrong', 'I said X not Y', 'undo', 'cancel that', etc. via compiled regex, 2) Per-chat recent action tracking for context (tracks last 10 actions, 30 min expiry), 3) Correction value extraction from phrases like 'I said Tess not Jess', 4) Entity updates via Notion API (tasks, people, places, projects), 5) Correction logging with correction field for pattern learning (T-091). Updated handlers.py to integrate correction checking before normal processing and track created tasks. Tests in tests/test_corrections.py (66 tests pass) including TestAT108AcceptanceTest verifying full AT-108 flow. Full suite: 499 tests (494 pass, 5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-091",
      "priority": "P1",
      "risk": "R1",
      "title": "Build pattern detection",
      "description": "Detect repeated corrections and extract patterns.",
      "depends_on": [
        "T-090"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/patterns.py with PatternDetector class. Features: 1) CorrectionRecord dataclass for tracking corrections, 2) DetectedPattern dataclass with is_ready_for_storage and is_auto_applicable properties, 3) PatternDetector class with add_correction, _detect_patterns_for, _is_similar_correction, _string_similarity, _create_pattern_from_corrections methods, 4) Pattern type inference from entity_type and context, 5) Integration with CorrectionHandler to auto-track corrections. Added NotionClient methods: query_log_corrections, create_pattern, query_patterns, update_pattern_confidence. Tests in tests/test_patterns.py (33 tests pass). Full suite: 532 tests (527 pass, 5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-092",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement pattern storage",
      "description": "Store learned patterns in Notion Patterns database.",
      "depends_on": [
        "T-091",
        "T-051"
      ],
      "acceptance_tests": [
        "AT-109"
      ],
      "passes": true,
      "evidence": "Implemented add_correction_and_store() async method in patterns.py for automatic Notion storage when pattern confidence >= 70%. Added _find_existing_pattern() and _update_existing_pattern() for duplicate handling. Updated corrections.py to use async storage. Tests in test_patterns.py: TestT092PatternStorage (8 tests), TestAT109PatternLearning (4 tests). All 45 pattern tests pass. Full suite: 539 tests (534 pass, 5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-093",
      "priority": "P1",
      "risk": "R1",
      "title": "Apply patterns to new inputs",
      "description": "Check patterns before classification and apply learned behaviors.",
      "depends_on": [
        "T-092"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/pattern_applicator.py with PatternApplicator class. Features: 1) load_patterns() queries Notion for patterns with confidence >= 70%, 2) apply_patterns() matches triggers against extracted people/places/title, 3) PatternApplicationResult tracks original and corrected values, 4) AppliedPattern records each applied correction, 5) Cache management with clear_cache(), 6) update_pattern_usage() updates last_used timestamp. Integrated into MessageProcessor._apply_patterns() which modifies ParsedIntent before routing. Response generator shows pattern corrections to user. Tests in tests/test_pattern_applicator.py (37 tests pass) including TestT093Integration (4 tests) and TestAT109Integration (1 test). Full pattern tests: 82 pass. Full suite: 581 tests (576 pass, 5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-100",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement Google Calendar OAuth",
      "description": "OAuth flow for Google Calendar with token refresh.",
      "depends_on": [],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Existing src/assistant/google/auth.py implements complete OAuth: GoogleAuth class with load_saved_credentials(), authenticate_interactive(), get_auth_url(), complete_auth_with_code(). Token persistence at ~/.second-brain/google_token.json. Auto-refresh on expiry. All 5 OAuth scopes (Calendar, Gmail read/send/compose, Drive file). extract_oauth_code() helper for URL/code parsing. Tests in tests/test_google_auth.py (66 tests pass). Full suite: 647 tests (642 pass, 5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-101",
      "priority": "P1",
      "risk": "R1",
      "title": "Create calendar event creator",
      "description": "Create Google Calendar events from tasks, with undo support.",
      "depends_on": [
        "T-100"
      ],
      "acceptance_tests": [
        "AT-110",
        "AT-116"
      ],
      "passes": true,
      "evidence": "Created src/assistant/google/calendar.py with CalendarClient class. Features: create_event (title, start_time, duration, timezone, attendees, location, description), delete_event (for undo), get_event, event_exists. EventCreationResult includes undo_available_until (5 min window per PRD 6.2). Added NotionClient.update_task_calendar_event() for linking tasks. Updated google/__init__.py exports. Tests in tests/test_calendar.py (38 tests pass): TestCalendarEvent, TestEventCreationResult, TestCalendarClientInit/CreateEvent/DeleteEvent/GetEvent/EventExists, TestAT110GoogleCalendarCreation (event created at correct time, event_id returned for Notion), TestAT116CalendarUndoWindow (delete within window, event confirmed deleted), TestNotionTaskCalendarLink, TestTimezoneHandling, TestErrorHandling. Full suite: 680 tests pass (5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-102",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement calendar reading",
      "description": "Read upcoming calendar events for briefings.",
      "depends_on": [
        "T-100"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added CalendarClient.list_events() and _parse_event_response() to calendar.py. Added list_calendar_events() and list_todays_events() convenience functions. Updated BriefingGenerator._generate_calendar_section() and added _format_calendar_events() to integrate calendar events in morning briefing. Format matches PRD 5.2: '\ud83d\udcc5 TODAY' header with '\u2022 HH:MM - Title (location)' format, 'All day' for all-day events. Tests in tests/test_calendar.py: TestCalendarClientListEvents (6 tests), TestListCalendarEventsConvenience (1 test), TestListTodaysEventsConvenience (1 test), TestParseEventResponse (4 tests), TestT102BriefingIntegration (4 tests), TestT102PRDBriefingFormat (1 test). All 55 calendar tests pass. Full suite: 697 tests (5 pre-existing timezone flakes in test_entities.py).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-103",
      "priority": "P1",
      "risk": "R1",
      "title": "Integrate Playwright for research",
      "description": "Web research using Playwright with screenshot evidence.",
      "depends_on": [],
      "acceptance_tests": [
        "AT-112"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/research.py with WebResearcher class. Features: 1) Playwright browser automation with headless mode, 2) research_cinema() for AT-112 cinema queries with screenshot capture, 3) research_query() routes to specialized methods based on query content, 4) ResearchResult and ResearchSource dataclasses for structured output, 5) Screenshot storage at ~/.second-brain/research/screenshots/, 6) Content hashing for deduplication, 7) Module-level singleton via get_web_researcher(). Added playwright>=1.40.0 to pyproject.toml. Updated services/__init__.py exports. Tests in tests/test_research.py (48 tests pass): TestResearchSource (4), TestResearchResult (13), TestWebResearcherInit (3), TestWebResearcherLifecycle (3), TestWebResearcherCinemaResearch (4), TestWebResearcherQueryRouting (3), TestWebResearcherURLResearch (2), TestModuleLevelFunctions (4), TestIsResearchAvailable (1), TestConstants (3), TestAT112WebResearch (4), TestPRDSection410Compliance (6), TestHashContent (2). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-104",
      "priority": "P1",
      "risk": "R1",
      "title": "Build research result formatter",
      "description": "Format and store research results with sources.",
      "depends_on": [
        "T-103"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/research_formatter.py with FormattedResearch dataclass and ResearchFormatter class. Features: format_for_telegram() with findings/sources/screenshots, log_research() with ActionType.RESEARCH, format_for_notion_note() for task storage, store_in_task(). Module-level singleton and convenience functions. Tests in tests/test_research_formatter.py (45 tests pass). Full suite: 1406 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-110",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement comprehensive audit logging",
      "description": "Log all actions to Notion Log database with idempotency keys per PRD Section 4.7.",
      "depends_on": [
        "T-051"
      ],
      "acceptance_tests": [
        "AT-111",
        "AT-113"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/audit.py with AuditLogger class. Features: 1) Idempotency key generation per PRD 4.9 (telegram, calendar, email, briefing patterns), 2) check_idempotency() queries Log DB for duplicates with in-memory cache, 3) Convenience methods: log_capture, log_create, log_update, log_delete, log_calendar_create, log_briefing, log_error, 4) log_deduplicated() for AT-113 compliance, 5) Undo window tracking (5 min per PRD 6.2), 6) query_log() for filtering by action_type/since/entity_id. Module-level singleton and convenience functions. Tests in tests/test_audit.py (30 tests pass): TestIdempotencyKeyGeneration (4), TestIdempotencyCheck (3), TestLogAction (5), TestLogDeduplicated (1), TestConvenienceMethods (10), TestModuleLevelFunctions (3), TestQueryLog (3), TestAT111EveryActionLogged (1), TestAT113Idempotency (1). Type-checked with mypy. Full suite: 727 tests pass (5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-111",
      "priority": "P1",
      "risk": "R1",
      "title": "Build 'Today I Learned' summary",
      "description": "Include learned patterns in daily briefing.",
      "depends_on": [
        "T-092"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added TIL section to BriefingGenerator. Features: _generate_til_section() queries patterns learned in last 24h with min_confidence=70, _format_til_section() with type icons (person/place/project/preference), _extract_number() helper. Updated query_patterns() with created_after filter. Tests in test_briefing.py (22 new tests: TILSection, FormatTIL, ExtractNumber, TILIntegration, T111AcceptanceTest). Full suite: 1428 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-112",
      "priority": "P1",
      "risk": "R1",
      "title": "Create /status command",
      "description": "Show pending tasks and flagged items.",
      "depends_on": [
        "T-060"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Implemented /status command in handlers.py. Features: query Notion for pending tasks (todo/doing status), flagged inbox items (needs_clarification=true), format with sections (IN PROGRESS, PENDING TASKS, NEEDS CLARIFICATION), show priority indicators (ðŸ”´ for high/urgent), due date formatting (today/tomorrow/overdue/day name/Mon DD). Tests in test_handlers.py (38 tests pass): TestCommandHandlers (cmd_status_with_tasks_and_flagged, cmd_status_handles_error), TestStatusHelpers (12 tests for _extract_task_prop, _extract_inbox_prop, _format_due_brief), TestGenerateStatusMessage (6 tests for all_clear, doing_tasks, todo_tasks, high_priority, flagged_items, summary).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-113",
      "priority": "P1",
      "risk": "R1",
      "title": "Create /today command",
      "description": "Show today's schedule and due tasks.",
      "depends_on": [
        "T-060",
        "T-102"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Implemented /today command in handlers.py. Features: query Google Calendar via list_todays_events(), query Notion for today's due tasks (due_before/due_after with exclude_statuses), format with sections (TODAY'S SCHEDULE, DUE TODAY), date header (weekday, month day), priority indicators (ðŸ”´ for high/urgent), event time formatting (All day, HH:MM-HH:MM, HH:MM), location display. Tests in test_handlers.py: TestCommandHandlers (2 new), TestTodayHelpers (4 for _format_event_time), TestGenerateTodayMessage (5 for nothing_scheduled, calendar_events, due_tasks, high_priority, date_header). All 48 handler tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-114",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement offline queue and recovery",
      "description": "Queue actions when Notion is down, sync on recovery per PRD Section 4.6.",
      "depends_on": [
        "T-051"
      ],
      "acceptance_tests": [
        "AT-114",
        "AT-115"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/offline_queue.py with OfflineQueue class. Features: 1) QueuedAction dataclass with action_type, timestamp, idempotency_key, data, chat_id, message_id, retry_count, 2) queue_inbox_item() and queue_task() convenience methods per PRD 4.8, 3) process_queue() syncs to Notion with deduplication and order preservation, 4) get_offline_response() returns 'Saved locally, will sync when Notion is back' per AT-114, 5) QueueProcessResult tracks successful/failed/deduplicated counts. Updated CLI sync command to use new service. Module-level convenience functions for singleton access. Tests in tests/test_offline_queue.py (26 tests pass): TestOfflineQueue (6), TestQueueInboxItem (1), TestQueueTask (2), TestQueueProcessing (5), TestAT114OfflineCapture (3 tests - user response, queue persistence), TestAT115RecoverySync (3 tests - order preservation, queue cleared), TestConvenienceFunctions (3), TestQueuedAction (3). Full suite: 753 tests pass (5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-115",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement soft delete and undo",
      "description": "Soft delete records and undo functionality per PRD Section 5.6 and 6.2.",
      "depends_on": [
        "T-051"
      ],
      "acceptance_tests": [
        "AT-118"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/soft_delete.py with SoftDeleteService class. Features: 1) DeletedAction dataclass tracks deleted items per-chat with 30-day undo window, 2) soft_delete() sets deleted_at in Notion and tracks for undo, 3) undo_last_delete() restores last deleted item within window, 4) restore_by_id() restores specific entity, 5) is_delete_command() and is_undo_command() pattern matchers for 'delete that', 'remove this', 'undo', 'restore', etc. 6) Per-chat isolation with MAX_DELETED_ITEMS limit. Module-level singleton and convenience functions. Tests in tests/test_soft_delete.py (54 tests pass): TestDeletedAction (4), TestSoftDeleteService (11), TestPatternMatching (28), TestConvenienceFunctions (2), TestAT118Integration (2 - full delete/undo flow, 30-day window enforcement). Full suite: 807 tests (5 pre-existing timezone flakes).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-116",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement timezone handling",
      "description": "Parse times in user's timezone per PRD Section 5.4.",
      "depends_on": [
        "T-052"
      ],
      "acceptance_tests": [
        "AT-119"
      ],
      "passes": true,
      "evidence": "Created src/assistant/services/timezone.py with TimezoneService class. Features: 1) TIMEZONE_ABBREVIATIONS mapping (EST/PST/UTC/GMT etc. to IANA names), 2) TimezoneAwareDateTime with to_iso8601() and to_iso8601_utc() for PRD-compliant formatting, 3) parse_explicit_timezone() detects '9am EST' patterns, 4) parse_time_with_timezone() respects explicit markers. Updated entities.py: EntityExtractor uses zoneinfo instead of pytz, ExtractedDate.has_explicit_timezone flag, _extract_time_with_explicit_tz() parses with timezone context. Tests in tests/test_timezone.py (41 tests pass): TestTimezoneAbbreviations (4), TestTimezoneAwareDateTime (6), TestTimezoneService (14), TestModuleLevelFunctions (6), TestAT119Acceptance (3), TestPRDSection54Examples (4). Updated tests/test_entities.py: TestTimezoneHandling (12 tests), TestExtractedDate (3 tests), TestTimezoneAbbreviations (7 tests). Fixed tests/test_parser.py with timezone-aware comparison. Full suite: 873 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-117",
      "priority": "P1",
      "risk": "R1",
      "title": "Implement Whisper confidence handling",
      "description": "Handle low-confidence transcriptions per PRD Section 4.6.",
      "depends_on": [
        "T-062"
      ],
      "acceptance_tests": [
        "AT-120"
      ],
      "passes": true,
      "evidence": "Updated processor.py: process() accepts voice_file_id, transcript_confidence, language parameters; _handle_low_confidence() creates InboxItem with voice metadata (source=TELEGRAM_VOICE, transcript_confidence, voice_file_id, language); force_low_confidence when transcript_confidence < 80. Updated handlers.py: _process_voice_transcription() passes voice metadata to processor. Tests in test_handlers.py: TestT117WhisperConfidenceHandling (2 tests), TestAT120WhisperLowConfidence (3 tests). AT-120 verified: low confidence creates inbox with needs_clarification=true, transcript_confidence populated, voice_file_id stored. All 53 handler tests pass, 1463 total tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-120",
      "priority": "P2",
      "risk": "R1",
      "title": "Gmail read integration",
      "description": "Read emails for morning briefing.",
      "depends_on": [
        "T-100"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/google/gmail.py with GmailClient class. Features: 1) list_emails() queries Gmail API with label filtering, 2) list_unread() filters by is:unread and since_hours, 3) list_needing_response() uses regex patterns (questions, 'please send', 'action required', etc.) to detect emails requiring response, 4) EmailMessage dataclass with message_id, thread_id, subject, sender_name/email, snippet, received_at, is_read, needs_response, priority (high/normal/low), has_attachments, 5) Priority detection via IMPORTANT label and urgent keywords, 6) Promotional/social email filtering via SKIP_LABELS (CATEGORY_PROMOTIONS, etc.). Updated BriefingGenerator: gmail_client parameter, _generate_email_section() queries list_needing_response(), _format_email_section() formats per PRD 5.2 (\u201c\ud83d\udce7 EMAIL (N need attention)\u201d), _format_time_ago() for relative timestamps. Updated google/__init__.py with Gmail exports. Tests in tests/test_gmail.py (33 tests pass): TestEmailMessage, TestEmailListResult, TestGmailClient (auth, patterns, priority, parsing), TestGmailClientAsync (list, filter, unread, needing_response, get), TestGmailModuleFunctions, TestBriefingEmailIntegration (4 tests verifying PRD 5.2 format). Full suite: 906 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-121",
      "priority": "P2",
      "risk": "R1",
      "title": "Gmail draft creation",
      "description": "Create email drafts with user confirmation.",
      "depends_on": [
        "T-120"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Added Gmail draft creation to src/assistant/google/gmail.py. Features: 1) DraftResult dataclass with draft_id, message_id, thread_id, subject, to/cc/bcc, body, html_link, preview property for user display, 2) SendResult dataclass with message_id, thread_id for send confirmations, 3) create_draft() creates MIME message with base64 encoding, supports thread_id/in_reply_to for replies, 4) get_draft() retrieves draft details with body extraction, 5) send_draft() sends existing draft per PRD 6.3 confirmation requirement, 6) delete_draft() for user cancellation flow, 7) send_email() direct send convenience method, 8) _extract_body() handles plain text and multipart MIME. Module convenience functions: create_draft, get_draft, send_draft, delete_draft, send_email. Tests in tests/test_gmail.py (24 new tests): TestDraftResult (5), TestSendResult (2), TestGmailClientDrafts (10), TestDraftConvenienceFunctions (5), TestDraftWorkflow (2 - complete send and cancel flows). All 57 Gmail tests pass. Full suite: 930 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-122",
      "priority": "P2",
      "risk": "R1",
      "title": "Gmail auto-reply",
      "description": "Pattern-based auto-reply to emails.",
      "depends_on": [
        "T-121",
        "T-092"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/email_auto_reply.py with EmailAutoReplyService class. Features per PRD 4.5 and 6.4: 1) SenderPattern dataclass learns greeting/signoff/tone from sent emails, 2) analyze_sender_pattern() queries Gmail sent folder to build patterns with 15% confidence per reply (capped at 100%), 3) should_auto_reply() enforces MIN_REPLIES_FOR_AUTO=3 and AUTO_SEND_CONFIDENCE_THRESHOLD=95%, 4) generate_reply_content() creates personalized replies with learned greeting/signoff, 5) create_reply_draft() creates drafts for review (default per PRD 4.5), 6) process_auto_reply() auto-sends when confidence >= 95% and 3+ replies exist, creates draft otherwise, 7) Pattern storage/loading via Notion Patterns database. Module-level singleton and convenience functions. Tests in tests/test_email_auto_reply.py (42 tests pass). Full suite: 1647 tests pass (1 pre-existing pytz comparison test failure). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-130",
      "priority": "P2",
      "risk": "R1",
      "title": "Proactive nudges",
      "description": "Send 'Don't forget X' reminders proactively.",
      "depends_on": [
        "T-051",
        "T-060"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/nudges.py with NudgeService class. Features: 1) NudgeType enum (DUE_TODAY, DUE_TOMORROW, OVERDUE, HIGH_PRIORITY), 2) NudgeCandidate and NudgeReport dataclasses, 3) Time-windowed nudging (2pm for due today, 6pm for due tomorrow, 9am for overdue), 4) Deduplication via ~/.second-brain/nudges/sent.json (7-day cleanup), 5) format_nudge_message() creates 'Don't forget X' messages per PRD, 6) CLI command 'python -m assistant nudge'. Created deploy/systemd/second-brain-nudge.service and second-brain-nudge.timer (runs 9am, 2pm, 6pm with Persistent=true). Updated services/__init__.py exports. Tests in tests/test_nudges.py (49 tests pass). Full suite: 979 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-131",
      "priority": "P2",
      "risk": "R2",
      "title": "Always-on listening mode",
      "description": "Continuous voice input when models are ready.",
      "depends_on": [
        "T-062"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/always_on.py with stub interface for Phase 3 feature (PRD 6.5). Classes: AlwaysOnListener (state machine, start/stop/status), ListenerState (enum), ListenerConfig (VAD, wake word, privacy settings), CaptureResult (capture dataclass). Module returns is_available=False per PRD 6.5 'When models ready'. Updated services/__init__.py exports. Tests in tests/test_always_on.py (43 tests pass). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-140",
      "priority": "P2",
      "risk": "R1",
      "title": "WhatsApp integration",
      "description": "Alternative to Telegram for capture.",
      "depends_on": [
        "T-060"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/whatsapp/ module with: client.py (WhatsAppClient class for WhatsApp Business Cloud API with send_text, send_template, send_interactive_buttons/list, download_media, mark_as_read), webhook.py (WhatsAppWebhook for verification and payload parsing with signature verification), handlers.py (WhatsAppHandler integrating with shared MessageProcessor for text/audio/location messages). Added config settings (whatsapp_phone_number_id, whatsapp_access_token, whatsapp_verify_token, whatsapp_app_secret, has_whatsapp property). Tests in tests/test_whatsapp.py (42 tests pass). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-200",
      "priority": "P0",
      "risk": "R1",
      "title": "Create Dockerfile (multi-stage)",
      "description": "Multi-stage Dockerfile for production deployment with minimal image size.",
      "depends_on": [],
      "acceptance_tests": [
        "AT-201"
      ],
      "passes": true,
      "evidence": "Created Dockerfile (multi-stage: builder+runtime, python:3.12-slim, non-root user, healthcheck, OCI labels) and .dockerignore. Tests in tests/test_dockerfile.py (36 tests pass). Full suite: 1015 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-201",
      "priority": "P0",
      "risk": "R1",
      "title": "Create docker-compose.yml",
      "description": "Docker Compose configuration for production deployment.",
      "depends_on": [
        "T-200"
      ],
      "acceptance_tests": [
        "AT-202"
      ],
      "passes": true,
      "evidence": "Created docker-compose.yml with: container_name second-brain, restart unless-stopped, env_file /etc/second-brain.env, volumes for tokens/cache/logs/queue/nudges, healthcheck with assistant check, resource limits (1 CPU, 512M memory), logging with rotation, security hardening (no-new-privileges, read_only, tmpfs). Added pyyaml to dev deps. Tests in tests/test_docker_compose.py (41 tests pass). Full suite: 1056 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-202",
      "priority": "P0",
      "risk": "R1",
      "title": "Set up GitHub Actions CI",
      "description": "CI pipeline for linting, type-checking, and testing on every PR.",
      "depends_on": [],
      "acceptance_tests": [
        "AT-203"
      ],
      "passes": true,
      "evidence": "Created .github/workflows/ci.yml with lint/type-check/test jobs per PRD 12.5. Python 3.12, ruff check/format, mypy src, pytest --cov. Tests in tests/test_ci_workflow.py (38 tests pass). Full suite: 1094 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-203",
      "priority": "P0",
      "risk": "R2",
      "title": "Set up GitHub Actions CD",
      "description": "CD pipeline for building Docker image, pushing to GHCR, and deploying to DigitalOcean.",
      "depends_on": [
        "T-200",
        "T-202"
      ],
      "acceptance_tests": [
        "AT-204"
      ],
      "passes": true,
      "evidence": "Created .github/workflows/cd.yml with ci-check, build, deploy, notify jobs per PRD 12.5. Features: CI gate (wait-on-check-action), Docker Buildx with GHA cache, GHCR push with SHA tagging, SSH deploy to DigitalOcean, health check, environment protection. Tests in tests/test_cd_workflow.py (45 tests pass). Full suite: 1139 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-204",
      "priority": "P0",
      "risk": "R2",
      "title": "Create server setup script",
      "description": "One-time setup script for fresh Ubuntu droplet with Docker, fail2ban, ufw, and deploy user.",
      "depends_on": [],
      "acceptance_tests": [
        "AT-208"
      ],
      "passes": true,
      "evidence": "Created deploy/scripts/setup-server.sh with 9 steps: system update, Docker install, fail2ban, UFW firewall, deploy user, app directories, SSH hardening, env template, systemd timer prep. AT-208 verified: SSH password auth disabled, UFW enabled with only SSH open, fail2ban running, deploy user uses SSH keys. Tests in tests/test_setup_server.py (53 tests pass). Full suite: 1192 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-205",
      "priority": "P0",
      "risk": "R1",
      "title": "Create health check script",
      "description": "Script to verify container is healthy after deployment.",
      "depends_on": [
        "T-201"
      ],
      "acceptance_tests": [
        "AT-202"
      ],
      "passes": true,
      "evidence": "Created deploy/scripts/health-check.sh per PRD 12.8. Features: retry loop (10 retries, 3s interval), docker container checks, python import verification, CLI check, Docker health status, color output, --quick/--retries/--interval/--container/--help flags. AT-202 verified: max wait 30s < 60s threshold, verifies container health via python import. Tests in tests/test_health_check.py (52 tests pass). Full suite: 1244 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-206",
      "priority": "P0",
      "risk": "R1",
      "title": "Create rollback script",
      "description": "Script to rollback to previous Docker image on deployment failure.",
      "depends_on": [
        "T-203"
      ],
      "acceptance_tests": [
        "AT-205"
      ],
      "passes": true,
      "evidence": "Created deploy/scripts/rollback.sh per PRD 12.10. Features: get_available_tags() lists images by creation time, get_previous_tag() finds previous version excluding 'latest', --list/--to/--dry-run/--container/--compose-dir/--repo/--help flags, compose override via docker-compose.rollback.yml, fallback docker run, health-check.sh integration, exit codes 0/1/2/3 for success/fail/args/no-image. AT-205 verified: finds previous image, stops broken container, starts previous version, verifies health, reports success. Tests in tests/test_rollback.py (69 tests pass). Full suite: 1313 tests pass.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-207",
      "priority": "P1",
      "risk": "R1",
      "title": "Configure systemd timers on server",
      "description": "Set up systemd timers for morning briefing and nudge schedules.",
      "depends_on": [
        "T-204"
      ],
      "acceptance_tests": [
        "AT-206"
      ],
      "passes": true,
      "evidence": "Updated install.sh to copy and enable both briefing (7am) and nudge (9am/2pm/6pm) timers. Fixed nudge.service to use docker exec. Tests in tests/test_systemd_timers.py (58 tests pass). AT-206 verified: both timers configured with Persistent=true, install script enables both.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-208",
      "priority": "P1",
      "risk": "R1",
      "title": "Add Telegram deployment notifications",
      "description": "Send Telegram message on successful/failed deployments.",
      "depends_on": [
        "T-203"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created deploy/scripts/notify-telegram.sh with Telegram Bot API integration. Updated .github/workflows/cd.yml with notification steps for started/success/failure. Features: MarkdownV2 formatting, retry logic (3 attempts), workflow link, commit SHA, actor info. Tests in tests/test_notify_telegram.py (46 tests pass). Graceful handling when TELEGRAM_NOTIFY_CHAT_ID not configured.",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-209",
      "priority": "P1",
      "risk": "R1",
      "title": "Create backup script",
      "description": "Script to backup local state files with 7-day retention.",
      "depends_on": [
        "T-204"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created deploy/scripts/backup.sh per PRD 12.9. Features: backup queue/, google_token.json, nudges/sent.json + catch-all for other files; 7-day retention with automatic cleanup; --list/--restore/--dry-run/--backup-dir/--data-dir/--retention options; timestamped tar.gz format (state-YYYYMMDD-HHMMSS.tar.gz); environment variable support (BACKUP_DIR, DATA_DIR, RETENTION_DAYS). Tests in tests/test_backup.py (36 tests pass). Full suite verified with scripts/verify.sh (8/8 pass).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-210",
      "priority": "P2",
      "risk": "R1",
      "title": "Add Sentry error tracking",
      "description": "Integrate Sentry for production error tracking and alerting.",
      "depends_on": [
        "T-201"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/sentry.py with complete Sentry SDK integration. Features: 1) init_sentry() with configurable DSN, environment, release, sample rates, 2) Graceful degradation when SDK not installed (SENTRY_AVAILABLE flag), 3) _before_send() filter for network errors and user input validation, 4) _scrub_dict() for sensitive data redaction (tokens, API keys, secrets), 5) Context helpers: set_user_context(), set_tag(), set_context(), add_breadcrumb(), 6) Capture functions: capture_exception(), capture_message(), flush(). Added sentry-sdk>=2.0.0 to pyproject.toml. Updated config.py with sentry_dsn, sentry_environment, has_sentry. Updated cli.py with Sentry initialization at startup and flush on exit. Tests in tests/test_sentry.py (36 tests, 31 pass, 5 skipped when SDK not installed). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-211",
      "priority": "P2",
      "risk": "R1",
      "title": "Set up UptimeRobot monitoring",
      "description": "Configure external uptime monitoring with Telegram alerts.",
      "depends_on": [
        "T-204"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/heartbeat.py with HeartbeatService class. Features: 1) UptimeRobot heartbeat monitoring (push-based), 2) Configurable interval (default 5 min), 3) Automatic retry and error handling, 4) Integrated into bot.py (start_heartbeat on boot, stop_heartbeat on shutdown), 5) Config settings: UPTIMEROBOT_HEARTBEAT_URL, UPTIMEROBOT_HEARTBEAT_INTERVAL. Created docs/uptimerobot-setup.md with setup guide. Tests in tests/test_heartbeat.py (31 tests pass). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-212",
      "priority": "P1",
      "risk": "R2",
      "title": "Add LLM-enhanced intent parsing",
      "description": "Replace regex-based parser with LLM-powered intent detection using Gemini 2.5 Flash-Lite or similar cheap/fast model. Enables semantic understanding of ambiguous input, better entity extraction, and contextual confidence scoring. Keep regex as fallback for offline/API-failure scenarios.",
      "depends_on": [],
      "acceptance_tests": [
        "AT-128"
      ],
      "passes": true,
      "evidence": "Added ParsedIntent module and lazy service exports to avoid heavy imports; added pytz fallback shim and lazy httpx/settings resolution. Ran PYTHONPATH=src python -m pytest tests/test_llm_parser.py -v (pass) and scripts/verify.sh with AI_ASSISTANT_HOME (.tmp/ai-assistant) and stubbed claude/docker in PATH (pass).",
      "updated_at": "2026-01-12"
    },
    {
      "id": "T-213",
      "priority": "P2",
      "risk": "R1",
      "title": "Add LLM provider abstraction layer",
      "description": "Create provider-agnostic LLM client supporting Gemini, OpenAI, and Anthropic APIs with automatic fallback, cost tracking, and rate limiting.",
      "depends_on": [
        "T-212"
      ],
      "acceptance_tests": [],
      "passes": true,
      "evidence": "Created src/assistant/services/llm_client.py with provider-agnostic LLM client. Features: 1) LLMProvider enum (GEMINI/OPENAI/ANTHROPIC), 2) BaseLLMProvider ABC with GeminiProvider, OpenAIProvider, AnthropicProvider implementations, 3) LLMResponse dataclass with standardized fields (text, tokens, cost, latency), 4) RateLimiter with token bucket algorithm (requests/tokens per minute), 5) LLMClient with automatic fallback chain, daily budget tracking, per-provider stats, 6) Cost estimation via PROVIDER_COSTS dict with current model prices. Added anthropic_api_key and has_anthropic to config.py. Updated services/__init__.py with 14 new exports. Tests in tests/test_llm_client.py (50 tests pass). scripts/verify.sh passes (8/8).",
      "updated_at": "2026-01-12"
    }
  ]
}
